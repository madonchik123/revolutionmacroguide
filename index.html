<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Revolution Macro Guide</title>

  <!-- StackEdit base typography -->
  <link rel="stylesheet" href="https://stackedit.io/style.css" />

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs%3E%3CradialGradient id='g' cx='50%25' cy='40%25' r='70%25'%3E%3Cstop offset='0%25' stop-color='%234aa3ff' stop-opacity='1'/%3E%3Cstop offset='60%25' stop-color='%234aa3ff' stop-opacity='.35'/%3E%3Cstop offset='100%25' stop-color='%23090b10' stop-opacity='1'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='64' height='64' rx='14' fill='url(%23g)'/%3E%3Cpath d='M18 40c7-12 12-17 18-17 6 0 9 4 10 10-2 10-8 15-18 15-5 0-8-2-10-8z' fill='%23090b10' opacity='.9'/%3E%3Cpath d='M20 38c6-10 10-14 16-14 5 0 7 3 8 8-2 8-7 12-16 12-4 0-6-2-8-6z' fill='%234aa3ff' opacity='.9'/%3E%3C/svg%3E" />

  <style>
    :root{
      /* Blue-only theme */
      --pageBlue: #06122a;   /* deep base */
      --pageBlue2:#050912;

      --panel: rgba(12, 14, 18, 0.88);
      --panel2: rgba(20, 24, 33, 0.70);
      --text: #e9e9ea;
      --muted: rgba(233,233,234,0.74);

      --neon: #4aa3ff;       /* primary accent */
      --stroke: rgba(255,255,255,0.16);
      --stroke2: rgba(74,163,255,0.34);

      --shadow: 0 18px 46px rgba(0,0,0,0.28);
      --shadow2: 0 10px 28px rgba(0,0,0,0.22);

      --headerH: 96px;

      --navW: 190px; /* kept for compatibility, but sidebar is removed */
      --navGap: 18px;
      --navRadius: 18px;

      --maxW: 1160px;
    }

    *{ box-sizing: border-box; }
    html{ scroll-behavior: auto; }

    /* Upgraded background: blue gradients + subtle static noise */
    body{
      margin:0;
      font-family: Arial, sans-serif;
      color: var(--text);
      min-height: 100vh;
      background:
        radial-gradient(1100px 680px at 18% 8%, rgba(74,163,255,0.20), transparent 62%),
        radial-gradient(860px 620px at 88% 18%, rgba(47,125,255,0.14), transparent 60%),
        radial-gradient(900px 760px at 40% 120%, rgba(74,163,255,0.10), transparent 55%),
        linear-gradient(180deg, var(--pageBlue), var(--pageBlue2) 58%, #040610);
    }
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.06;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      mix-blend-mode: overlay;
    }

    /* ===== header ===== */
    .app-header{
      position: fixed;
      top:0; left:0; right:0;
      z-index: 9999;
      padding: 14px 18px 12px;
      background: rgba(10, 12, 16, 0.88);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 14px 30px rgba(0,0,0,0.25);
    }
    .app-header::after{
      content:"";
      position:absolute;
      left:0; right:0; bottom:-1px;
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(74,163,255,0.44), transparent);
      pointer-events:none;
    }

    .header-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      min-height: 44px;
    }

    .brand-wrap{
      display:flex;
      align-items:baseline;
      gap:10px;
      white-space: nowrap;
    }

    .brand-title{
      font-weight: 900;
      letter-spacing: 0.2px;
      font-size: 18px;
      display:flex;
      align-items:baseline;
      gap:10px;
    }
    .brand-title .brand{
      color: var(--text);
      text-shadow: 0 0 18px rgba(255,255,255,0.06);
    }

    .typingWrap{
      display:inline-flex;
      align-items:baseline;
      gap:4px;
      min-width: 240px;
    }
    .typing{
      color: var(--neon);
      text-shadow: 0 0 16px rgba(74,163,255,0.28);
      font-weight: 900;
    }
    .caret{
      display:inline-block;
      color: var(--neon);
      opacity: 0.95;
      transform: translateY(1px);
      animation: blink 1s steps(1, end) infinite;
      text-shadow: 0 0 16px rgba(74,163,255,0.28);
    }
    @keyframes blink{ 50%{ opacity: 0; } }

    .header-actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

    .pill-link{
      text-decoration:none;
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(15,17,21,0.62);
      padding: 10px 14px;
      border-radius: 14px;
      box-shadow: 0 10px 22px rgba(0,0,0,0.18);
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      display:inline-flex;
      align-items:center;
      user-select:none;
      cursor:pointer;
    }
    .pill-link:hover{
      transform: translateY(-1px);
      border-color: rgba(74,163,255,0.40);
      background: rgba(15,17,21,0.78);
    }

    /* Hamburger now available on all screen sizes (since sidebar is gone) */
    .hamburger{
      display:inline-flex;
      width: 42px;
      height: 42px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(15,17,21,0.62);
      color: var(--neon);
      cursor:pointer;
      align-items:center;
      justify-content:center;
      box-shadow: 0 10px 22px rgba(0,0,0,0.18);
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
    }
    .hamburger:hover{
      transform: translateY(-1px);
      border-color: rgba(74,163,255,0.40);
      background: rgba(15,17,21,0.78);
    }

    .header-tabs{
      display:flex;
      align-items:flex-end;
      gap:10px;
      padding-top: 10px;
      flex-wrap: wrap;
    }

    .tab-btn{
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(15,17,21,0.55);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      font-size: 15px;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .tab-btn:hover{
      transform: translateY(-1px);
      border-color: rgba(74,163,255,0.40);
      background: rgba(15,17,21,0.72);
    }
    .tab-btn.active{
      border-color: rgba(74,163,255,0.56);
      box-shadow: 0 0 0 1px rgba(74,163,255,0.18) inset, 0 0 26px rgba(74,163,255,0.10);
    }
    .tab-dot{
      width: 8px; height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.25);
      box-shadow: 0 0 0 2px rgba(0,0,0,0.2) inset;
    }
    .tab-btn.active .tab-dot{
      background: var(--neon);
      box-shadow: 0 0 18px rgba(74,163,255,0.34);
    }

    /* ===== app layout ===== */
    .app{
      padding-top: calc(var(--headerH) + 18px);
      padding-left: 18px;
      padding-right: 18px;
      padding-bottom: 28px;
    }

    /* Sidebar removed: force single column */
    .layout{
      display:grid;
      grid-template-columns: minmax(0, 1fr);
      gap: var(--navGap);
      max-width: var(--maxW);
      margin: 0 auto;
      align-items:start;
    }
    .layout.no-side{
      grid-template-columns: minmax(0, 1fr);
    }

    /* ===== sidebar (removed) ===== */
    .side{ display:none !important; }

    /* ===== panel ===== */
    .panel{
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 18px;
      background: rgba(15, 17, 21, 0.86);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      padding: 18px;
      overflow:hidden;
      min-height: 320px;
    }

    .tab-content{ display:none; }
    .tab-content.active{ display:block; animation: fadeInUp 220ms ease both; }
    @keyframes fadeInUp{
      from{ opacity: 0; transform: translateY(6px); }
      to{ opacity: 1; transform: translateY(0); }
    }

    .stackedit__html{ color: var(--text); }
    .stackedit__html h1, .stackedit__html h2, .stackedit__html h3, .stackedit__html h4,
    .stackedit__html p, .stackedit__html li{ color: var(--text); }
    .stackedit__html a{
      color: var(--text);
      text-decoration: underline;
      text-decoration-color: rgba(74,163,255,0.40);
    }

    /* REMOVE the weird lines on headers/subheaders */
    .stackedit__html h1,
    .stackedit__html h2{
      border: none !important;
      padding-bottom: 0 !important;
    }
    .stackedit__html h1::after,
    .stackedit__html h2::after{
      display:none !important;
    }

    /* copy buttons for code blocks */
    pre{
      position: relative;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(10,12,16,0.72);
      box-shadow: 0 10px 24px rgba(0,0,0,0.20);
      padding: 14px;
      overflow: auto;
    }
    pre code{
      color: var(--text);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
      line-height: 1.5;
    }
    .copy-btn{
      position:absolute;
      top:10px;
      right:10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(15,17,21,0.70);
      color: rgba(233,233,234,0.92);
      padding: 8px 10px;
      cursor:pointer;
      font-weight: 900;
      font-size: 12px;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      user-select:none;
    }
    .copy-btn:hover{
      transform: translateY(-1px);
      border-color: rgba(74,163,255,0.40);
      background: rgba(15,17,21,0.85);
    }
    .copy-btn.copied{
      color: var(--neon);
      border-color: rgba(74,163,255,0.56);
      box-shadow: 0 0 18px rgba(74,163,255,0.10);
    }

    /* ===== troubleshooting ===== */
    .ts-head{ margin-bottom: 10px; }
    .ts-title{
      margin: 0;
      font-size: 26px;
      font-weight: 1000;
      letter-spacing: 0.2px;
      border: none !important;
      padding-bottom: 0 !important;
    }
    .ts-title::after{ display:none !important; }

    .ts-sub{
      margin: 8px 0 0;
      color: var(--muted);
      line-height: 1.35;
      max-width: 760px;
    }

    .ts-toolbar{
      display:flex;
      flex-wrap: wrap;
      align-items:center;
      gap: 10px;
      margin: 14px 0 14px;
    }

    .ts-search{
      flex: 1;
      min-width: 220px;
      display:flex;
      gap: 10px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(10,12,16,0.48);
    }
    .ts-search input{
      width:100%;
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: 15px;
    }
    .ts-search .icon{
      color: rgba(233,233,234,0.65);
      font-weight: 900;
    }

    .ts-filter-pill{
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(15,17,21,0.55);
      color: rgba(233,233,234,0.92);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 1000;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      user-select:none;
      white-space: nowrap;
    }
    .ts-filter-pill:hover{
      transform: translateY(-1px);
      border-color: rgba(74,163,255,0.40);
      background: rgba(15,17,21,0.72);
    }
    .ts-filter-pill.active{
      color: var(--neon);
      border-color: rgba(74,163,255,0.56);
      box-shadow: 0 0 0 1px rgba(74,163,255,0.12) inset, 0 0 26px rgba(74,163,255,0.10);
    }

    .cat-grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 12px;
      margin: 14px 0 14px;
    }

    .cat-card{
      border: 1px solid rgba(74,163,255,0.24);
      border-radius: 16px;
      background: rgba(10,12,16,0.42);
      padding: 14px;
      cursor:pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,0.18);
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      position: relative;
      overflow:hidden;
      user-select:none;
    }
    .cat-card::before{
      content:"";
      position:absolute;
      inset:-40px;
      background: radial-gradient(520px 180px at 20% 20%, rgba(74,163,255,0.18), transparent 60%);
      opacity: 0.9;
      pointer-events:none;
    }
    .cat-card:hover{
      transform: translateY(-2px);
      border-color: rgba(74,163,255,0.44);
      background: rgba(10,12,16,0.55);
    }
    .cat-card.active{
      border-color: rgba(74,163,255,0.62);
      box-shadow: 0 0 0 1px rgba(74,163,255,0.14) inset, 0 0 34px rgba(74,163,255,0.12);
    }

    .cat-title{ font-weight: 1000; font-size: 18px; color: var(--text); }
    .cat-sub{ color: var(--muted); margin-top: 6px; font-size: 13px; line-height: 1.25; }

    .issues-wrap{
      margin-top: 10px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .issue-block{
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: 16px;
      background: rgba(10,12,16,0.44);
      overflow:hidden;
      box-shadow: 0 10px 22px rgba(0,0,0,0.16);
    }

    .issue-title{
      width: 100%;
      text-align:left;
      appearance:none;
      border:none;
      background: transparent;
      color: var(--text);
      padding: 14px;
      font-size: 16px;
      font-weight: 1000;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      user-select:none;
    }
    .issue-title:hover{ background: rgba(15,17,21,0.35); }

    .issue-title .chev{
      color: rgba(233,233,234,0.70);
      font-weight: 1000;
      transition: transform .15s ease;
    }

    .issue-body{
      display:none;
      padding: 0 14px 14px;
      color: rgba(233,233,234,0.92);
      line-height: 1.45;
    }
    .issue-body.open{ display:block; animation: fadeInUp 180ms ease both; }

    .empty{
      padding: 14px;
      color: rgba(233,233,234,0.70);
      border: 1px dashed rgba(255,255,255,0.18);
      border-radius: 16px;
      background: rgba(10,12,16,0.30);
    }

    /* mobile */
    #backToTopMobile{
      position: fixed;
      right: 18px;
      bottom: 18px;
      z-index: 999;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(10,12,16,0.72);
      color: rgba(233,233,234,0.92);
      cursor:pointer;
      display:none;
      box-shadow: 0 10px 22px rgba(0,0,0,0.20);
    }
    #backToTopMobile:hover{
      border-color: rgba(74,163,255,0.40);
      color: var(--neon);
    }

    @media (max-width: 980px){
      .cat-grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 560px){
      .typingWrap{ display:none; }
      .cat-grid{ grid-template-columns: 1fr; }
      .pill-link{ padding: 10px 12px; }
      .tab-btn{ padding: 10px 12px; }

      /* Keep header from becoming huge; allow horizontal scroll instead of wrapping away buttons */
      .app-header{ padding: 10px 12px 10px; }
      .brand-title{ font-size: 16px; }
      .header-actions{
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        max-width: 100%;
        gap: 8px;
        padding-bottom: 2px;
      }
      .header-actions .pill-link{ flex: 0 0 auto; }
      .header-actions::-webkit-scrollbar{ display:none; }

      .header-tabs{
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        gap: 8px;
      }
      .header-tabs .tab-btn{ flex: 0 0 auto; }
      .header-tabs::-webkit-scrollbar{ display:none; }
    }

    /* drawer (quick jump for all devices now) */
    .drawer-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      backdrop-filter: blur(3px);
      z-index: 9998;
      display:none;
    }
    .drawer{
      position: fixed;
      top: var(--headerH);
      left: 12px;
      width: min(280px, calc(100vw - 24px));
      max-height: calc(100vh - var(--headerH) - 12px);
      overflow:auto;
      z-index: 9999;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.14);
      background:
        linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)),
        rgba(74, 163, 255, 0.14);
      box-shadow: var(--shadow);
      display:none;
    }
    .drawer.open, .drawer-backdrop.open{ display:block; animation: fadeInUp 160ms ease both; }

    /* drawer internal styles reused from sidebar */
    .side-header{
      padding: 14px 12px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      position:relative;
    }
    .side-header::after{
      content:"";
      position:absolute;
      left:10px; right:10px; bottom:-1px;
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(74,163,255,0.38), transparent);
      pointer-events:none;
    }
    .side-title{
      font-size: 13px;
      letter-spacing: 1px;
      font-weight: 900;
      text-transform: uppercase;
      color: rgba(233,233,234,0.88);
      text-shadow: 0 0 16px rgba(74,163,255,0.10);
    }
    .side-links{
      padding: 12px 10px 10px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .side-links a,
    .side-links button{
      display:block;
      width:100%;
      text-decoration:none;
      text-align:left;
      color: rgba(233,233,234,0.94);
      font-weight: 900;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(15,17,21,0.55);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      user-select:none;
      cursor:pointer;
    }
    .side-links a:hover,
    .side-links button:hover{
      transform: translateY(-1px);
      border-color: rgba(74,163,255,0.34);
      background: rgba(15,17,21,0.70);
    }
    .side-links a.active{
      color: var(--neon);
      border-color: rgba(74,163,255,0.56);
      box-shadow: 0 0 0 1px rgba(74,163,255,0.12) inset, 0 0 26px rgba(74,163,255,0.10);
      text-shadow: 0 0 16px rgba(74,163,255,0.18);
    }
    .side-footer{
      padding: 0 10px 14px;
    }
    #drawerTopBtn{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-weight: 1000;
    }

    /* ===== music modal ===== */
    .modal-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(6px);
      z-index: 10000;
      display:none;
    }
    .modal{
      position: fixed;
      z-index: 10001;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: min(820px, calc(100vw - 26px));
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(12, 14, 18, 0.92);
      box-shadow: 0 20px 70px rgba(0,0,0,0.40);
      display:none;
      overflow:hidden;
    }
    .modal.open, .modal-backdrop.open{ display:block; }
    .modal-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 14px 14px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
    }
    .modal-title{
      font-weight: 1000;
      letter-spacing: 0.2px;
      color: var(--text);
    }
    .modal-sub{
      margin-top: 2px;
      color: rgba(233,233,234,0.70);
      font-size: 13px;
      font-weight: 700;
    }
    .modal-close{
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(15,17,21,0.62);
      color: rgba(233,233,234,0.92);
      padding: 10px 12px;
      cursor:pointer;
      font-weight: 1000;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      user-select:none;
    }
    .modal-close:hover{
      transform: translateY(-1px);
      border-color: rgba(74,163,255,0.40);
      background: rgba(15,17,21,0.78);
      color: var(--neon);
    }
    .modal-body{
      padding: 14px;
    }
    .yt-wrap{
      border-radius: 16px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(10,12,16,0.55);
      box-shadow: 0 12px 28px rgba(0,0,0,0.26);
      aspect-ratio: 16 / 9;
      width: 100%;
    }
    .yt-wrap iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
    }
    .modal-foot{
      padding: 0 14px 14px;
      color: rgba(233,233,234,0.72);
      font-size: 12px;
      line-height: 1.35;
    }

    /* ===== language gate ===== */
    .lang-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.72);
      backdrop-filter: blur(10px);
      z-index: 20000;
      display:none;
    }
    .lang-modal{
      position: fixed;
      z-index: 20001;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: min(560px, calc(100vw - 26px));
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(12, 14, 18, 0.96);
      box-shadow: 0 22px 70px rgba(0,0,0,0.55);
      overflow:hidden;
      display:none;
    }
    .lang-modal.open, .lang-backdrop.open{ display:block; }
    .lang-head{
      padding: 16px 16px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      position:relative;
    }
    .lang-head::after{
      content:"";
      position:absolute;
      left:14px; right:14px; bottom:-1px;
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(74,163,255,0.44), transparent);
      pointer-events:none;
    }
    .lang-title{
      margin: 0;
      font-size: 18px;
      font-weight: 1000;
      letter-spacing: 0.2px;
      color: var(--text);
    }
    .lang-sub{
      margin: 8px 0 0;
      color: rgba(233,233,234,0.70);
      font-size: 13px;
      line-height: 1.35;
    }
    .lang-body{
      padding: 14px 16px 16px;
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .lang-choice{
      flex: 1;
      min-width: 200px;
      border-radius: 16px;
      border: 1px solid rgba(74,163,255,0.24);
      background: rgba(10,12,16,0.50);
      padding: 14px;
      cursor:pointer;
      box-shadow: 0 12px 28px rgba(0,0,0,0.22);
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      user-select:none;
      text-align:left;
    }
    .lang-choice:hover{
      transform: translateY(-2px);
      border-color: rgba(74,163,255,0.44);
      background: rgba(10,12,16,0.62);
    }
    .lang-choice .big{
      font-weight: 1000;
      font-size: 16px;
      color: var(--text);
    }
    .lang-choice .small{
      margin-top: 6px;
      color: rgba(233,233,234,0.70);
      font-size: 13px;
      line-height: 1.3;
    }
  </style>
</head>

<body>
  <!-- Language gate -->
  <div id="langBackdrop" class="lang-backdrop" aria-hidden="true"></div>
  <div id="langModal" class="lang-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Choose language">
    <div class="lang-head">
      <h3 class="lang-title" id="langTitle">Choose your language</h3>
      <p class="lang-sub" id="langSub">You can change this later.</p>
    </div>
    <div class="lang-body">
      <button class="lang-choice" id="chooseEN" type="button">
        <div class="big">English</div>
        <div class="small">Use the site in English.</div>
      </button>
      <button class="lang-choice" id="chooseRU" type="button">
        <div class="big">Русский</div>
        <div class="small">Использовать сайт на русском.</div>
      </button>
    </div>
  </div>

  <!-- Music modal -->
  <div id="musicBackdrop" class="modal-backdrop" aria-hidden="true"></div>
  <div id="musicModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Music Player">
    <div class="modal-head">
      <div>
        <div class="modal-title" id="musicModalTitle">Music</div>
        <div class="modal-sub" id="musicModalSub">Note Block Hypixel Skyblock OST — Sky of Trees (Forest Islands)</div>
      </div>
      <button id="musicClose" class="modal-close" type="button">Close</button>
    </div>
    <div class="modal-body">
      <div class="yt-wrap">
        <iframe
          id="musicFrame"
          src="https://www.youtube.com/embed/x3bBQasjbfs?loop=1&playlist=x3bBQasjbfs&controls=1&modestbranding=1&rel=0"
          title="Music Player"
          allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen>
        </iframe>
      </div>
    </div>
    <div class="modal-foot" id="musicModalFoot">
      If it does not start automatically, press Play in the video player. It will loop.
    </div>
  </div>

  <!-- Quick Jump drawer (now primary on all devices) -->
  <div id="drawerBackdrop" class="drawer-backdrop" aria-hidden="true"></div>
  <div id="drawer" class="drawer" aria-hidden="true">
    <div class="side-header">
      <div class="side-title" id="drawerQuickJumpTitle">Quick Jump</div>
    </div>
    <div id="drawerLinks" class="side-links"></div>
    <div class="side-footer">
      <button id="drawerTopBtn" type="button">Top</button>
    </div>
  </div>

  <!-- SINGLE header -->
  <header class="app-header" id="appHeader">
    <div class="header-row">
      <div class="brand-wrap">
        <button id="hamburger" class="hamburger" title="Open Quick Jump" aria-label="Open Quick Jump">☰</button>

        <div class="brand-title">
          <span class="brand">Revolution Macro</span>
          <span class="typingWrap">
            <span class="typing" id="typingWord"></span><span class="caret" id="typingCaret">|</span>
          </span>
        </div>
      </div>

      <div class="header-actions">
        <button class="pill-link" id="musicBtn" type="button">Music</button>

        <a class="pill-link" id="openIssuesBtn" href="https://github.com/RevolutionGuides/revolutionmacroguide/issues" target="_blank" rel="noopener noreferrer">
          Open Issues
        </a>
        <a class="pill-link" id="submitFixBtn" href="https://github.com/RevolutionGuides/revolutionmacroguide/issues/new?template=troubleshooting.yml" target="_blank" rel="noopener noreferrer">
          Submit Fix
        </a>

        <button class="pill-link" id="langBtn" type="button">EN</button>
      </div>
    </div>

    <div class="header-tabs">
      <button class="tab-btn active" id="tabGuideBtn" type="button" data-tab="guide">
        <span class="tab-dot"></span> <span id="tabGuideText">Clickpath Guide</span>
      </button>
      <button class="tab-btn" id="tabTroubleBtn" type="button" data-tab="troubleshooting">
        <span class="tab-dot"></span> <span id="tabTroubleText">Troubleshooting</span>
      </button>
    </div>
  </header>

  <main class="app">
    <div class="layout no-side" id="layout">
      <!-- Main content -->
      <section class="main">
        <div class="panel">
          <!-- GUIDE TAB -->
          <div id="guide" class="tab-content active">
            <div class="stackedit__html" id="guideContent"></div>
          </div>

          <!-- TROUBLESHOOTING TAB -->
          <div id="troubleshooting" class="tab-content">
            <div class="ts-head">
              <h2 class="ts-title" id="tsTitle">Troubleshooting</h2>
              <p class="ts-sub" id="tsSub">
                Pick a category, search within it, and expand an entry for the exact fix. If you found a new solution, submit it using the button in the header.
              </p>
            </div>

            <div class="cat-grid" id="catGrid">
              <div class="cat-card" data-cat="mac">
                <div class="cat-title" id="catMacTitle">Mac</div>
                <div class="cat-sub" id="catMacSub">Accessibility, permissions, macOS fixes</div>
              </div>
              <div class="cat-card" data-cat="windows">
                <div class="cat-title" id="catWinTitle">Windows</div>
                <div class="cat-sub" id="catWinSub">Capture mode, drivers, Windows fixes</div>
              </div>
              <div class="cat-card" data-cat="macro">
                <div class="cat-title" id="catMacroTitle">Macro</div>
                <div class="cat-sub" id="catMacroSub">Settings, patterns, routing, resets</div>
              </div>
              <div class="cat-card" data-cat="pro">
                <div class="cat-title" id="catProTitle">Pro</div>
                <div class="cat-sub" id="catProSub">Advanced tips, high efficiency setups</div>
              </div>
            </div>

            <div class="ts-toolbar">
              <div class="ts-search" title="Search current category">
                <span class="icon" id="tsSearchLabel">Search</span>
                <input id="tsSearch" type="text" placeholder="Search fixes..." />
              </div>

              <button id="allCatsBtn" class="ts-filter-pill active" type="button">All</button>
              <button class="ts-filter-pill" type="button" data-filter="mac" id="pillMac">Mac</button>
              <button class="ts-filter-pill" type="button" data-filter="windows" id="pillWin">Windows</button>
              <button class="ts-filter-pill" type="button" data-filter="macro" id="pillMacro">Macro</button>
              <button class="ts-filter-pill" type="button" data-filter="pro" id="pillPro">Pro</button>
            </div>

            <div id="issues" class="issues-wrap"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <button id="backToTopMobile" type="button">Top</button>

  <script>
    /* ===== language ===== */
    const I18N = {
      en: {
        htmlLang: "en",
        langBtn: "EN",
        langGateTitle: "Choose your language",
        langGateSub: "You can change this later.",
        langChoiceENBig: "English",
        langChoiceENSmall: "Use the site in English.",
        langChoiceRUBig: "Русский",
        langChoiceRUSmall: "Use the site in Russian.",
        musicBtn: "Music",
        openIssues: "Open Issues",
        submitFix: "Submit Fix",
        tabGuide: "Clickpath Guide",
        tabTrouble: "Troubleshooting",
        quickJump: "Quick Jump",
        top: "Top",
        typingWords: ["Guide", "Troubleshooting Help"],
        tsTitle: "Troubleshooting",
        tsSub: "Pick a category, search within it, and expand an entry for the exact fix. If you found a new solution, submit it using the button in the header.",
        searchLabel: "Search",
        searchPlaceholder: "Search fixes...",
        all: "All",
        catMacSub: "Accessibility, permissions, macOS fixes",
        catWinSub: "Capture mode, drivers, Windows fixes",
        catMacroSub: "Settings, patterns, routing, resets",
        catProSub: "Advanced tips, high efficiency setups",
        modalClose: "Close",
        musicFoot: "If it does not start automatically, press Play in the video player. It will loop.",
        loadingFixes: "Loading fixes…",
        noMatches: "No matching entries yet.",
        loadFail: "Could not load troubleshooting.json.",
        copy: "Copy",
        copied: "Copied",
        failed: "Failed",
        nav: {
          gather: "Gather Tab (1)",
          collect: "Collect Tab (2)",
          planters: "Planters Tab (3)",
          status: "Status Tab (4)",
          tools: "Tools Tab (5)",
          settings: "Settings Tab (6)"
        }
      },
      ru: {
        htmlLang: "ru",
        langBtn: "RU",
        langGateTitle: "Выберите язык",
        langGateSub: "Можно поменять позже.",
        langChoiceENBig: "English",
        langChoiceENSmall: "Использовать сайт на английском.",
        langChoiceRUBig: "Русский",
        langChoiceRUSmall: "Использовать сайт на русском.",
        musicBtn: "Музыка",
        openIssues: "Открыть Issues",
        submitFix: "Отправить решение",
        tabGuide: "Гайд по клику (Clickpath)",
        tabTrouble: "Проблемы и решения",
        quickJump: "Быстрый переход",
        top: "Наверх",
        typingWords: ["Гайд", "Помощь"],
        tsTitle: "Проблемы и решения",
        tsSub: "Выберите категорию, ищите внутри неё и раскрывайте пункт, чтобы увидеть точное решение. Если нашли новое решение — отправьте его через кнопку в шапке.",
        searchLabel: "Поиск",
        searchPlaceholder: "Искать решения...",
        all: "Все",
        catMacSub: "Доступ, разрешения, исправления macOS",
        catWinSub: "Capture mode, драйверы, исправления Windows",
        catMacroSub: "Настройки, паттерны, маршруты, ресеты",
        catProSub: "Продвинутые советы, эффективность",
        modalClose: "Закрыть",
        musicFoot: "Если не запускается автоматически, нажмите Play в плеере. Будет играть по кругу.",
        loadingFixes: "Загрузка решений…",
        noMatches: "Пока нет совпадений.",
        loadFail: "Не удалось загрузить troubleshooting.json.",
        copy: "Копировать",
        copied: "Скопировано",
        failed: "Ошибка",
        nav: {
          gather: "Вкладка Gather (1)",
          collect: "Вкладка Collect (2)",
          planters: "Вкладка Planters (3)",
          status: "Вкладка Status (4)",
          tools: "Вкладка Tools (5)",
          settings: "Вкладка Settings (6)"
        }
      }
    };

    let CURRENT_LANG = "en";

    function applyLanguage(lang){
      if (!I18N[lang]) lang = "en";
      CURRENT_LANG = lang;
      const t = I18N[lang];

      document.documentElement.lang = t.htmlLang;

      const langBtn = document.getElementById("langBtn");
      if (langBtn) langBtn.textContent = t.langBtn;

      const langTitle = document.getElementById("langTitle");
      const langSub = document.getElementById("langSub");
      if (langTitle) langTitle.textContent = t.langGateTitle;
      if (langSub) langSub.textContent = t.langGateSub;

      const chooseEN = document.getElementById("chooseEN");
      const chooseRU = document.getElementById("chooseRU");
      if (chooseEN){
        chooseEN.querySelector(".big").textContent = t.langChoiceENBig;
        chooseEN.querySelector(".small").textContent = t.langChoiceENSmall;
      }
      if (chooseRU){
        chooseRU.querySelector(".big").textContent = t.langChoiceRUBig;
        chooseRU.querySelector(".small").textContent = t.langChoiceRUSmall;
      }

      const musicBtn = document.getElementById("musicBtn");
      if (musicBtn) musicBtn.textContent = t.musicBtn;

      const openIssuesBtn = document.getElementById("openIssuesBtn");
      if (openIssuesBtn) openIssuesBtn.firstChild.nodeValue = t.openIssues;

      const submitFixBtn = document.getElementById("submitFixBtn");
      if (submitFixBtn) submitFixBtn.firstChild.nodeValue = t.submitFix;

      const tabGuideText = document.getElementById("tabGuideText");
      const tabTroubleText = document.getElementById("tabTroubleText");
      if (tabGuideText) tabGuideText.textContent = t.tabGuide;
      if (tabTroubleText) tabTroubleText.textContent = t.tabTrouble;

      const drawerQuick = document.getElementById("drawerQuickJumpTitle");
      if (drawerQuick) drawerQuick.textContent = t.quickJump;

      const drawerTopBtn = document.getElementById("drawerTopBtn");
      const backTopMobile = document.getElementById("backToTopMobile");
      if (drawerTopBtn) drawerTopBtn.textContent = t.top;
      if (backTopMobile) backTopMobile.textContent = t.top;

      const tsTitle = document.getElementById("tsTitle");
      const tsSub = document.getElementById("tsSub");
      if (tsTitle) tsTitle.textContent = t.tsTitle;
      if (tsSub) tsSub.textContent = t.tsSub;

      const tsSearchLabel = document.getElementById("tsSearchLabel");
      const tsSearch = document.getElementById("tsSearch");
      if (tsSearchLabel) tsSearchLabel.textContent = t.searchLabel;
      if (tsSearch) tsSearch.placeholder = t.searchPlaceholder;

      const allCatsBtn = document.getElementById("allCatsBtn");
      if (allCatsBtn) allCatsBtn.textContent = t.all;

      const catMacSub = document.getElementById("catMacSub");
      const catWinSub = document.getElementById("catWinSub");
      const catMacroSub = document.getElementById("catMacroSub");
      const catProSub = document.getElementById("catProSub");
      if (catMacSub) catMacSub.textContent = t.catMacSub;
      if (catWinSub) catWinSub.textContent = t.catWinSub;
      if (catMacroSub) catMacroSub.textContent = t.catMacroSub;
      if (catProSub) catProSub.textContent = t.catProSub;

      const musicModalTitle = document.getElementById("musicModalTitle");
      const musicClose = document.getElementById("musicClose");
      const musicFoot = document.getElementById("musicModalFoot");
      if (musicModalTitle) musicModalTitle.textContent = t.musicBtn;
      if (musicClose) musicClose.textContent = t.modalClose;
      if (musicFoot) musicFoot.textContent = t.musicFoot;

      renderGuide();
      syncHeaderHeight();
    }

    function openLanguageGate(){
      const bd = document.getElementById("langBackdrop");
      const md = document.getElementById("langModal");
      if (!bd || !md) return;
      bd.classList.add("open");
      md.classList.add("open");
      bd.setAttribute("aria-hidden", "false");
      md.setAttribute("aria-hidden", "false");
    }

    function closeLanguageGate(){
      const bd = document.getElementById("langBackdrop");
      const md = document.getElementById("langModal");
      if (!bd || !md) return;
      bd.classList.remove("open");
      md.classList.remove("open");
      bd.setAttribute("aria-hidden", "true");
      md.setAttribute("aria-hidden", "true");
    }

    function setLanguage(lang){
      localStorage.setItem("site_lang", lang);
      applyLanguage(lang);
      closeLanguageGate();
      TYPE_WORDS = I18N[CURRENT_LANG].typingWords;
    }

    function syncHeaderHeight(){
      const header = document.getElementById("appHeader");
      if (!header) return;
      const h = header.offsetHeight || 96;
      document.documentElement.style.setProperty("--headerH", h + "px");
    }
    window.addEventListener("resize", syncHeaderHeight);

    function isMobile(){
      return window.matchMedia("(max-width: 980px)").matches;
    }

    function scrollToWithOffset(el){
      if (!el) return;
      syncHeaderHeight();
      const header = document.getElementById("appHeader");
      const offset = (header ? header.offsetHeight : 0) + 14;
      const y = el.getBoundingClientRect().top + window.pageYOffset - offset;
      window.scrollTo({ top: y, behavior: isMobile() ? "auto" : "smooth" });
    }

    const layout = document.getElementById("layout");

    function openTab(tabId){
      document.querySelectorAll(".tab-content").forEach(el => el.classList.remove("active"));
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));

      const active = document.getElementById(tabId);
      if (active) active.classList.add("active");

      const btn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
      if (btn) btn.classList.add("active");

      /* Sidebar removed: always single-column layout */
      if (layout) layout.classList.add("no-side");

      closeDrawer();
      if (tabId === "troubleshooting") ensureIssuesLoaded();

      syncHeaderHeight();
    }

    document.getElementById("tabGuideBtn").addEventListener("click", () => openTab("guide"));
    document.getElementById("tabTroubleBtn").addEventListener("click", () => openTab("troubleshooting"));

    const drawer = document.getElementById("drawer");
    const drawerBackdrop = document.getElementById("drawerBackdrop");
    const hamburger = document.getElementById("hamburger");

    function openDrawer(){
      syncHeaderHeight();
      drawer.classList.add("open");
      drawerBackdrop.classList.add("open");
      drawer.setAttribute("aria-hidden", "false");
      drawerBackdrop.setAttribute("aria-hidden", "false");
    }
    function closeDrawer(){
      drawer.classList.remove("open");
      drawerBackdrop.classList.remove("open");
      drawer.setAttribute("aria-hidden", "true");
      drawerBackdrop.setAttribute("aria-hidden", "true");
    }

    hamburger.addEventListener("click", () => {
      if (drawer.classList.contains("open")) closeDrawer();
      else openDrawer();
    });
    drawerBackdrop.addEventListener("click", closeDrawer);

    function goTop(){
      window.scrollTo({ top: 0, behavior: isMobile() ? "auto" : "smooth" });
    }
    document.getElementById("drawerTopBtn").addEventListener("click", () => { goTop(); closeDrawer(); });

    const backToTopMobile = document.getElementById("backToTopMobile");
    window.addEventListener("scroll", () => {
      const show = isMobile() && window.scrollY > 380;
      backToTopMobile.style.display = show ? "block" : "none";
    });
    backToTopMobile.addEventListener("click", goTop);

    const musicBtn = document.getElementById("musicBtn");
    const musicModal = document.getElementById("musicModal");
    const musicBackdrop = document.getElementById("musicBackdrop");
    const musicClose = document.getElementById("musicClose");

    function openMusic(){
      musicModal.classList.add("open");
      musicBackdrop.classList.add("open");
      musicModal.setAttribute("aria-hidden", "false");
      musicBackdrop.setAttribute("aria-hidden", "false");
    }
    function closeMusic(){
      musicModal.classList.remove("open");
      musicBackdrop.classList.remove("open");
      musicModal.setAttribute("aria-hidden", "true");
      musicBackdrop.setAttribute("aria-hidden", "true");
    }
    musicBtn.addEventListener("click", openMusic);
    musicClose.addEventListener("click", closeMusic);
    musicBackdrop.addEventListener("click", closeMusic);
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && musicModal.classList.contains("open")) closeMusic();
    });

    document.getElementById("langBtn").addEventListener("click", openLanguageGate);

    let TYPE_WORDS = ["Guide", "Troubleshooting Help"];
    (function titleTypewriter(){
      const el = document.getElementById("typingWord");
      if (!el) return;

      let w = 0, i = 0, deleting = false;

      function tick(){
        const words = TYPE_WORDS;
        const word = words[w];

        if (!deleting){
          i++;
          el.textContent = word.slice(0, i);
          if (i >= word.length){
            deleting = true;
            return setTimeout(tick, 1600);
          }
          return setTimeout(tick, 120);
        } else {
          i--;
          el.textContent = word.slice(0, i);
          if (i <= 0){
            deleting = false;
            w = (w + 1) % words.length;
            return setTimeout(tick, 560);
          }
          return setTimeout(tick, 85);
        }
      }
      tick();
    })();

    /* ===== GUIDE RENDER (NOW FETCHES EXTERNAL FILES) ===== */
    function renderGuide(){
      const el = document.getElementById("guideContent");
      if (!el) return;

      const path = (CURRENT_LANG === "ru") ? "content/guide.ru.html" : "content/guide.en.html";
      const cacheBust = Date.now();

      fetch(path + "?v=" + cacheBust, { cache: "no-store" })
        .then(res => {
          if (!res.ok) throw new Error("Failed to load guide: " + path + " (" + res.status + ")");
          return res.text();
        })
        .then(html => {
          el.innerHTML = html;
          addCopyButtons(el);
          syncHeaderHeight();
        })
        .catch(err => {
          console.error(err);
          el.innerHTML = `<div class="empty">Could not load ${path}. Make sure it exists in your repo.</div>`;
        });
    }

    function addCopyButtons(root){
      const blocks = (root || document).querySelectorAll("pre");
      blocks.forEach(pre => {
        if (pre.querySelector(".copy-btn")) return;

        const btn = document.createElement("button");
        btn.className = "copy-btn";
        btn.type = "button";
        btn.textContent = I18N[CURRENT_LANG].copy;

        btn.addEventListener("click", async () => {
          const code = pre.querySelector("code");
          const text = code ? code.innerText : pre.innerText;

          try{
            await navigator.clipboard.writeText(text);
            btn.classList.add("copied");
            btn.textContent = I18N[CURRENT_LANG].copied;
            setTimeout(() => {
              btn.classList.remove("copied");
              btn.textContent = I18N[CURRENT_LANG].copy;
            }, 900);
          }catch(e){
            btn.textContent = I18N[CURRENT_LANG].failed;
            setTimeout(() => (btn.textContent = I18N[CURRENT_LANG].copy), 900);
          }
        });

        pre.appendChild(btn);
      });
    }

    /* Build Quick Jump (drawer only; still exactly 6 items; still uses heading IDs unchanged) */
    function buildSixItemNav(){
      const drawerLinks = document.getElementById("drawerLinks");
      if (!drawerLinks) return;

      const t = I18N[CURRENT_LANG];

      const wanted = [
        { label: t.nav.gather, id: "gather-tab-1" },
        { label: t.nav.collect, id: "collect-tab-2" },
        { label: t.nav.planters, id: "planters-tab-3" },
        { label: t.nav.status, id: "status-tab-4" },
        { label: t.nav.tools, id: "tools-tab-5" },
        { label: t.nav.settings, id: "settings-tab-6" },
      ];

      drawerLinks.innerHTML = "";

      wanted.forEach(item => {
        const targetEl = document.getElementById(item.id);
        if (!targetEl) return;

        const a = document.createElement("a");
        a.href = "#" + item.id;
        a.dataset.target = item.id;
        a.textContent = item.label;

        a.addEventListener("click", (e) => {
          e.preventDefault();
          scrollToWithOffset(targetEl);
          history.replaceState(null, "", "#" + item.id);
          closeDrawer();
        });

        drawerLinks.appendChild(a);
      });
    }

    /* Troubleshooting: load + render */
    let TROUBLE_CACHE = null;
    let TROUBLE_LOADED = false;

    function stripEmoji(text){
      if (!text) return "";
      return text
        .replace(/:[a-zA-Z0-9_+-]+:/g, "")
        .replace(/[\u{1F300}-\u{1FAFF}]/gu, "")
        .replace(/\s{2,}/g, " ")
        .trim();
    }

    function getRepoContext(){
      return { owner: "RevolutionGuides", repo: "revolutionmacroguide", branch: "main" };
    }

    async function fetchTroubleJson(){
      const { owner, repo, branch } = getRepoContext();
      const cacheBust = Date.now();
      const tries = [
        `troubleshooting.json?v=${cacheBust}`,
        `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/.github/troubleshooting.json?v=${cacheBust}`,
        `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/troubleshooting.json?v=${cacheBust}`,
      ];

      let lastErr = null;
      for (const url of tries){
        try{
          const res = await fetch(url, { cache: "no-store" });
          if (!res.ok) throw new Error(`Fetch failed (${res.status}) for ${url}`);
          return await res.json();
        }catch(e){
          lastErr = e;
        }
      }
      throw lastErr || new Error("Failed to load troubleshooting.json");
    }

    async function ensureIssuesLoaded(){
      if (TROUBLE_LOADED) return;
      TROUBLE_LOADED = true;

      const container = document.getElementById("issues");
      container.innerHTML = `<div class="empty">${I18N[CURRENT_LANG].loadingFixes}</div>`;

      try{
        const data = await fetchTroubleJson();
        TROUBLE_CACHE = (data || []).map(i => ({
          title: stripEmoji(i.title || "Untitled fix"),
          category: (i.category || "").toLowerCase().trim(),
          solution: (i.solution || ""),
        }));
        renderTroubleshooting();
      }catch(err){
        console.error(err);
        container.innerHTML = `
          <div class="empty">
            ${I18N[CURRENT_LANG].loadFail}<br><br>
            Quick fix: keep a copy at repo root as <b>/troubleshooting.json</b> OR rely on the raw GitHub URL.
          </div>`;
      }
    }

    let activeCat = "all";
    let searchQ = "";

    const tsSearch = document.getElementById("tsSearch");
    tsSearch.addEventListener("input", (e) => {
      searchQ = (e.target.value || "").toLowerCase();
      renderTroubleshooting();
    });

    document.querySelectorAll(".cat-card").forEach(card => {
      card.addEventListener("click", () => {
        setCategory(card.dataset.cat || "all");
        const issuesEl = document.getElementById("issues");
        if (issuesEl) setTimeout(() => scrollToWithOffset(issuesEl), 40);
      });
    });

    const allCatsBtn = document.getElementById("allCatsBtn");
    allCatsBtn.addEventListener("click", () => setCategory("all"));
    document.querySelectorAll(".ts-filter-pill[data-filter]").forEach(btn => {
      btn.addEventListener("click", () => setCategory(btn.dataset.filter));
    });

    function setCategory(cat){
      activeCat = cat || "all";

      document.querySelectorAll(".ts-filter-pill").forEach(p => p.classList.remove("active"));
      if (activeCat === "all") allCatsBtn.classList.add("active");
      else {
        const pill = document.querySelector(`.ts-filter-pill[data-filter="${activeCat}"]`);
        if (pill) pill.classList.add("active");
      }

      document.querySelectorAll(".cat-card").forEach(c => c.classList.remove("active"));
      if (activeCat !== "all"){
        const card = document.querySelector(`.cat-card[data-cat="${activeCat}"]`);
        if (card) card.classList.add("active");
      }

      renderTroubleshooting();
    }

    function renderTroubleshooting(){
      const container = document.getElementById("issues");
      if (!container) return;

      const data = TROUBLE_CACHE || [];
      const filtered = data.filter(item => {
        const catOK = (activeCat === "all") ? true : item.category === activeCat;
        if (!catOK) return false;

        if (!searchQ) return true;
        const t = (item.title || "").toLowerCase();
        const b = (item.solution || "").toLowerCase();
        return t.includes(searchQ) || b.includes(searchQ);
      });

      if (!filtered.length){
        container.innerHTML = `<div class="empty">${I18N[CURRENT_LANG].noMatches}</div>`;
        return;
      }

      container.innerHTML = "";
      filtered.forEach((issue) => {
        const block = document.createElement("div");
        block.className = "issue-block";

        const btn = document.createElement("button");
        btn.className = "issue-title";
        btn.type = "button";

        const left = document.createElement("div");
        left.textContent = issue.title || "Untitled fix";

        const chev = document.createElement("div");
        chev.className = "chev";
        chev.textContent = "▾";

        btn.appendChild(left);
        btn.appendChild(chev);

        const body = document.createElement("div");
        body.className = "issue-body";
        body.innerHTML = issue.solution || "";

        btn.addEventListener("click", () => {
          const open = body.classList.toggle("open");
          chev.style.transform = open ? "rotate(180deg)" : "rotate(0deg)";
          if (open) addCopyButtons(body);
        });

        block.appendChild(btn);
        block.appendChild(body);
        container.appendChild(block);
      });
    }

    document.getElementById("chooseEN").addEventListener("click", () => setLanguage("en"));
    document.getElementById("chooseRU").addEventListener("click", () => setLanguage("ru"));

    syncHeaderHeight();
    openTab("guide");

    (function initLang(){
      const saved = localStorage.getItem("site_lang");
      if (saved === "en" || saved === "ru"){
        applyLanguage(saved);
      } else {
        applyLanguage("en");
        openLanguageGate();
      }

      TYPE_WORDS = I18N[CURRENT_LANG].typingWords;

      renderGuide();
      setTimeout(buildSixItemNav, 200);
    })();

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape"){
        const saved = localStorage.getItem("site_lang");
        if (saved === "en" || saved === "ru"){
          closeLanguageGate();
        }
      }
    });

    window.addEventListener("load", () => {
      syncHeaderHeight();
      const id = (location.hash || "").replace("#", "");
      if (id){
        setTimeout(() => {
          const el = document.getElementById(id);
          if (el) scrollToWithOffset(el);
        }, 250);
      }
    });

    /* rebuild nav after guide loads (when switching language too) */
    const _oldApplyLanguage = applyLanguage;
    applyLanguage = function(lang){
      _oldApplyLanguage(lang);
      setTimeout(buildSixItemNav, 200);
    };
  </script>
</body>
</html>
